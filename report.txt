CREATE OR REPLACE PROCEDURE PR_APP_USER_CREATE (
    P_USERNAME VARCHAR2,
    P_USERPASSWORD VARCHAR2
    ) AUTHID CURRENT_USER IS
  
    VSQL VARCHAR2(200);
    VChkUser number(5);
  
    BEGIN
   SELECT COUNT(*) INTO VChkUser FROM ALL_USERS WHERE USERNAME = P_USERNAME;
 
   IF VChkUser >0 THEN
 
       EXECUTE IMMEDIATE('DROP USER '||P_USERNAME);
       DBMS_OUTPUT.PUT_LINE('user dropped') ;
         -- if u donot want to drop the existing user
   --  DBMS_OUTPUT.PUT_LINE('User Already exist');
     --exit;
 

   END IF;

   VSQL :='CREATE USER '||P_USERNAME||' IDENTIFIED BY '||P_USERPASSWORD;
 
   DBMS_OUTPUT.PUT_LINE(VSQL);
 
   EXECUTE IMMEDIATE(VSQL);
   DBMS_OUTPUT.PUT_LINE('user created');
 
   EXECUTE IMMEDIATE('GRANT CREATE SESSION TO '||P_USERNAME);
   EXECUTE IMMEDIATE('GRANT CONNECT , RESOURCE TO '||P_USERNAME);

   DBMS_OUTPUT.PUT_LINE('Role granted to user');
 
   --GRANTING SELECT PRIVILEDGES ON TABLE TO TRADER;
 
   EXECUTE IMMEDIATE('GRANT SELECT ON theteamproject.ADMIN TO '||P_USERNAME);
   EXECUTE IMMEDIATE('GRANT SELECT ON theteamproject.TRADERS TO '||P_USERNAME);
   EXECUTE IMMEDIATE('GRANT SELECT ON theteamproject.CUSTOMER TO '||P_USERNAME);
   EXECUTE IMMEDIATE('GRANT SELECT ON theteamproject.CATEGORY TO '||P_USERNAME);
   EXECUTE IMMEDIATE('GRANT SELECT ON theteamproject.ORDERS TO '||P_USERNAME);
     EXECUTE IMMEDIATE('GRANT SELECT ON theteamproject.PRODUCT TO '||P_USERNAME);
   EXECUTE IMMEDIATE('GRANT SELECT ON theteamproject.SHOP TO '||P_USERNAME);
 
  DBMS_OUTPUT.PUT_LINE('access granted on table to user');

  END;
 /